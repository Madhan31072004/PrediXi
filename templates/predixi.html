<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PrediXi - Predict Your Team</title>

  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- jQuery CDN -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
    .error { color: red; margin-top: 1rem; }
    .loading { color: blue; margin-top: 1rem; }
    body {
      background-color: #f8f9fa;
    }
    .form-section {
      background-color: #fff;
      border-radius: 0.5rem;
      padding: 2rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.05);
    }
    h2 {
      font-weight: bold;
      color: #343a40;
    }
  </style>
</head>
<body>

  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10">
        <div class="form-section">
          <h2 class="mb-4 text-center">Predict Your Cricket Team</h2>

          <!-- Match Format -->
          <div class="mb-3">
            <label for="match_format" class="form-label">Select Match Format:</label>
            <select id="match_format" class="form-select">
              <option value="">--Select--</option>
              <option value="Test">Test</option>
              <option value="ODI">ODI</option>
            </select>
          </div>

          <!-- Venue -->
          <div class="mb-3">
            <label for="venue" class="form-label">Select Venue:</label>
            <select id="venue" class="form-select">
              <option value="">--Select Venue--</option>
            </select>
          </div>

          <!-- Team Names -->
          <div class="mb-3">
            <label for="team1" class="form-label">Enter Team 1 Name:</label>
            <input type="text" id="team1" class="form-control" placeholder="Enter Team 1 Name">
          </div>

          <div class="mb-3">
            <label for="team2" class="form-label">Enter Team 2 Name:</label>
            <input type="text" id="team2" class="form-control" placeholder="Enter Team 2 Name">
          </div>

          <!-- Players -->
          <div class="mb-3">
            <label for="players1" class="form-label">Enter Team 1 Players (comma-separated):</label>
            <input type="text" id="players1" class="form-control" placeholder="Player1, Player2, ...">
          </div>

          <div class="mb-3">
            <label for="players2" class="form-label">Enter Team 2 Players (comma-separated):</label>
            <input type="text" id="players2" class="form-control" placeholder="Player1, Player2, ...">
          </div>

          <!-- Submit Button -->
          <div class="d-grid">
            <button id="predict_btn" class="btn btn-primary">Get Predicted Teams</button>
          </div>

          <!-- Feedback -->
          <div id="feedback" class="mt-3 text-center"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {
      // Update venue options based on match format
      $("#match_format").change(function () {
        const format = $(this).val();
        let venues = [];

        if (format === "ODI") {
          venues = ["Chennai", "Kolkata", "Jaipur", "Delhi"];
        } else if (format === "Test") {
          venues = ["Dehradun", "Thiruvananthapuram", "Ahmedabad"];
        }

        const venueDropdown = $("#venue");
        venueDropdown.empty().append('<option value="">--Select Venue--</option>');
        venues.forEach(v => venueDropdown.append(`<option value="${v}">${v}</option>`));
      });

      // Handle predict button
      $("#predict_btn").click(function () {
        const team1 = $("#team1").val().trim();
        const team2 = $("#team2").val().trim();
        const players1 = $("#players1").val().split(',').map(p => p.trim()).filter(Boolean);
        const players2 = $("#players2").val().split(',').map(p => p.trim()).filter(Boolean);
        const format_type = $("#match_format").val();
        const venue = $("#venue").val();

        // Validate input
        const teamNames = [team1, team2];
        if (
          !format_type || !venue ||
          teamNames.some(t => !t) ||
          team1.toLowerCase() === team2.toLowerCase() ||
          players1.length !== 11 ||
          players2.length !== 11
        ) {
          $("#feedback").html('<p class="error">Please fill all fields, ensure team names are unique, and each team has exactly 11 players.</p>');
          return;
        }

        $("#feedback").html('<p class="loading">Predicting teams, please wait...</p>');
        $("#predict_btn").prop('disabled', true);

        // Send data to server
        $.ajax({
          url: "/predict",
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify({
            players: [...players1, ...players2],
            format_type,
            venue,
            team1_name: team1,
            team2_name: team2
          }),
          success: function (response) {
            if (response.status === "success") {
              window.location.href = "/team";
            } else {
              $("#feedback").html(`<p class="error">Error: ${response.error || 'Unexpected response from server.'}</p>`);
              $("#predict_btn").prop('disabled', false);
            }
          },
          error: function (xhr) {
            const errorMsg = xhr.responseJSON?.error || 'Unknown error';
            $("#feedback").html(`<p class="error">Error predicting teams: ${errorMsg}</p>`);
            $("#predict_btn").prop('disabled', false);
          }
        });
      });
    });
  </script>
  
</body>
</html>
